<mat-card class="balance-card" [class]="getColorBalance()" (click)="abrirDeudas()" [class.clickeable]="resumen && !cargando">
  <!-- Loading State -->
  @if (cargando) {
    <div class="loading-state">
      <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
      <span>Cargando balance...</span>
    </div>
  }

  <!-- Necesita Pareja -->
  @if (necesitaPareja && !cargando) {
    <mat-card-content class="pareja-setup-content">
      <mat-icon>people_outline</mat-icon>
      <div class="setup-title">Configura tu Pareja</div>
      <div class="setup-message">Para usar el sistema de pagos y deudas, necesitas estar en una pareja con otro usuario</div>
      <button mat-raised-button color="primary" (click)="configurarPareja()">
        <mat-icon>add</mat-icon>
        Configurar Pareja
      </button>
    </mat-card-content>
  }

  <!-- Error State -->
  @if (error && !cargando && !necesitaPareja) {
    <mat-card-content class="error-content">
      <mat-icon>error_outline</mat-icon>
      <span>{{ error }}</span>
      <button mat-button (click)="cargarResumen()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </mat-card-content>
  }

  <!-- Balance Content -->
  @if (resumen && !cargando) {
    <mat-card-content class="balance-content">
      <!-- Header with Arrow -->
      <div class="balance-header">
        <div class="header-left">
          <mat-icon class="balance-icon">account_balance_wallet</mat-icon>
          <div class="balance-title">Balance de Deudas</div>
        </div>
        <mat-icon class="arrow-icon">chevron_right</mat-icon>
      </div>

      <!-- Balance Info -->
      <div class="balance-info">
        <div class="balance-message">{{ resumen.mensajeBalance }}</div>
        @if (resumen.saldoPendiente > 0) {
          <div class="balance-amount">
            ${{ resumen.saldoPendiente | number: '1.2-2' }}
          </div>
        }
      </div>

      <!-- Actions (Mostrar solo si mostrarBotones = true) -->
      @if (mostrarBotones) {
        <div class="balance-actions">
          @if (resumen.saldoPendiente > 0) {
            <button mat-raised-button color="primary" (click)="abonarPago(); $event.stopPropagation()">
              <mat-icon>payment</mat-icon>
              Abonar Pago
            </button>
          }
          <button mat-stroked-button (click)="verHistorial(); $event.stopPropagation()">
            <mat-icon>history</mat-icon>
            Ver Historial
          </button>
        </div>
      }
    </mat-card-content>
  }
</mat-card>

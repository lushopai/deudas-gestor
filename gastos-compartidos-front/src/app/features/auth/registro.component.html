<div class="registro-container">
  <div class="header-section">
    <div class="logo"><mat-icon>account_balance_wallet</mat-icon></div>
    <h1 class="app-title">Crear Cuenta</h1>
    <p class="app-subtitle">Únete a Gastos Compartidos</p>
  </div>

  <mat-card class="registro-card">
    <mat-card-content>
      <form [formGroup]="formulario" (ngSubmit)="registro()">
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <mat-icon matIconPrefix>email</mat-icon>
          <input matInput type="email" formControlName="email">
          @if (tieneError('email')) {
            <mat-error>Email inválido</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <mat-icon matIconPrefix>person</mat-icon>
          <input matInput type="text" formControlName="nombre">
          @if (tieneError('nombre')) {
            <mat-error>Nombre requerido (mín. 2 caracteres)</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Apellido (Opcional)</mat-label>
          <mat-icon matIconPrefix>badge</mat-icon>
          <input matInput type="text" formControlName="apellido">
        </mat-form-field>

        <div class="password-section">
          <mat-form-field appearance="outline">
            <mat-label>Contraseña</mat-label>
            <mat-icon matIconPrefix>lock</mat-icon>
            <input matInput [type]="mostrarPassword ? 'text' : 'password'" formControlName="password">
            <button mat-icon-button matIconSuffix type="button" (click)="togglePassword()">
              <mat-icon>{{ mostrarPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
          </mat-form-field>

          @if (formulario.get('password')?.value) {
            <div class="password-requirements">
              <p class="requirements-title">Requisitos:</p>
              <div class="requirement-item" [class.completed]="checkPassword('lowercase')">
                <mat-icon>{{ checkPassword('lowercase') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>Letra minúscula</span>
              </div>
              <div class="requirement-item" [class.completed]="checkPassword('uppercase')">
                <mat-icon>{{ checkPassword('uppercase') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>Letra mayúscula</span>
              </div>
              <div class="requirement-item" [class.completed]="checkPassword('number')">
                <mat-icon>{{ checkPassword('number') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>Número</span>
              </div>
              <div class="requirement-item" [class.completed]="checkPassword('special')">
                <mat-icon>{{ checkPassword('special') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>Carácter especial (@$!%*?&)</span>
              </div>
              <div class="requirement-item" [class.completed]="checkPassword('length')">
                <mat-icon>{{ checkPassword('length') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                <span>Mínimo 8 caracteres</span>
              </div>
            </div>
          }
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Confirmar Contraseña</mat-label>
          <mat-icon matIconPrefix>lock_outline</mat-icon>
          <input matInput type="password" formControlName="confirmPassword">
          @if (formulario.errors?.['passwordMismatch'] && formulario.get('confirmPassword')?.touched) {
            <mat-error>Las contraseñas no coinciden</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Nombre del Grupo (Opcional)</mat-label>
          <mat-icon matIconPrefix>group</mat-icon>
          <input matInput type="text" formControlName="nombrePareja">
        </mat-form-field>

        <button mat-raised-button color="primary" type="submit" class="submit-button"
          [disabled]="formulario.invalid || cargando">
          @if (cargando) {
            <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
          } @else {
            <span>Crear Cuenta</span>
          }
        </button>
      </form>

      <div class="login-link">
        <p>¿Ya tienes cuenta? <a routerLink="/login">Inicia sesión aquí</a></p>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="footer">
    <p class="footer-text">© 2026 Gastos Compartidos</p>
  </div>
</div>
